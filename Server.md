# Архитектура серверного ПО

## Основной процесс
Работает по аналогии с master процессом Nginx 
- запускается с параметрами
- запускает дочерние процессы и следит за тем, чтобы они работали
- тестирует конфигурацию - nginx -t
- обрабатывает управляющие сигналы - nginx -s reload / stop / quit / reopen

## Модули
Каждый модуль предназначен для выполнения какой-либо одной специфической задачи. Используемые модули и их взаимосвязи описываются в конфигурации наподобие конфигурации fluent-bit или fluentd.
Каждый модуль представляет из себя отдельный процесс. Взаимодействие модулей асинхронное, так как у каждого модуля своя скорость работы.

### Необходимые модули
1. Processing - Модуль обработки изображений с помощью нейронной сети
Модуль читает из входящей очереди изображение в виде бинарных данных
Модуль кладет в выходную очередь результаты обработки изображения в YOLO формате
   
2. Input - Модуль обработки видео, передаваемого с помощью протокола RTSP
Модуль читает видео кадры, передаваемые по RTSP протоколу
Модуль кладет принятые видео кадры в выходную очередь
Выходная очередь модуля может быть входящей очередь для модуля обработки изображений с помощью нейронной сети
   
3. Input - Модуль обработки видео, передаваемого с помощью протокола RTMP
Модуль читает видео кадры, передаваемые по RTMP протоколу
Модуль кладет принятые видео кадры в выходную очередь
Выходная очередь модуля может быть входящей очередь для модуля обработки изображений с помощью нейронной сети

4. Input - Модуль обработки видео, передаваемого с помощью протокола Motion JPEG (MJPEG)
Модуль читает видео кадры, передаваемые с помощью протокола MJPEG
Модуль кладет принятые видео кадры в выходную очередь
Выходная очередь модуля может быть входящей очередь для модуля обработки изображений с помощью нейронной сети

5. Input - Модуль получения изображений, получаемых с помощью HTTP(S) запросов.

6. Input - Модуль отслеживания файлов изображений в директории
Модуль отслеживает появление новых изображений в директории.
При появлении новых изображений модуль читает появившиеся изображения и кладет их в выходную очередь.

7. Input - Модуль отслеживания видео файлов в директории
Модуль отслеживает появление новых видео в директории.
При появлении новых видео файлов в директории модуль читает кадры из появившихся видео файлов и кладет их в выходную очередь.
Выходная очередь модуля может быть входящей очередь для модуля обработки изображений с помощью нейронной сети

8. Output - Модуль передачи видео с помощью протокола RTSP
9. Output - Модуль передачи видео с помощью протокола RTMP
10. Output - Модуль сохранения кадров в файл
11. Output - Модуль сохранения изображений в файл
12. Модуль отправки результатов обработки по протоколу HTTP(S)
13. Модуль отправки результатов обработки по протоколу TCP
14. Модуль отправки результатов обработки по протоколу UDP
15. Модуль проксирования ONVIF сообщений

# Очереди и обмен сообщениями
Redis
NATS
NQS
17. Vjl
